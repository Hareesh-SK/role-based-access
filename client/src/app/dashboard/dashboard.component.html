<div class="dashboard-container">

  <!-- Message -->
  @if (message) {
    <mat-card class="message">{{ message }}</mat-card>
  }

  <div class="header flex items-center gap-3 mb-4">
    
    <div class="logout-wrapper" (click)="confirmLogout()" matTooltip="Logout">
      <mat-icon class="logout-icon">power_settings_new</mat-icon>
      <div class="logout-text">Log Out</div>
    </div>

    <h2>Welcome, {{ currentUser?.name }} ({{ currentUser?.role }})</h2>

    @if (isAdmin) {
      @if(isEdit){
        <button mat-raised-button color="primary" (click)="addUser()">Add User</button>
        <button mat-raised-button color="primary" (click)="toggleEdit()">Save</button>
        <button mat-button color="warn" (click)="cancelEdit()">Cancel</button>

      }@else{
        <button mat-raised-button color="primary" (click)="toggleEdit()">Edit</button>
      }
      
    }
  </div>

  <!-- Pagination Top -->
  @if (totalPages > 1) {
    <div class="pagination flex items-center gap-3 mb-3">
      <button mat-stroked-button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">Prev</button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button mat-stroked-button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
    </div>
  }

<table class="mat-elevation-z2 w-full">
  <thead>
    <tr>
      <th>User ID</th>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
    </tr>
  </thead>
  <tbody>
   @for (user of paginatedUsers; track user._id) {
    <tr [class.new-row]="user.isNew">
      <td>
        @if (isEdit) {
          <mat-form-field appearance="outline" class="w-40">
            <input matInput [(ngModel)]="user.userId" />
          </mat-form-field>
        } @else {
          {{ user.userId }}
        }
      </td>

        <td>
          @if (isEdit) {
            <mat-form-field appearance="outline" class="w-40">
              <input matInput [(ngModel)]="user.name" />
            </mat-form-field>
          } @else {
            {{ user.name }}
          }
        </td>

        <td>
          @if (isEdit) {
            <mat-form-field appearance="outline" class="w-60">
              <input matInput [(ngModel)]="user.email" />
            </mat-form-field>
          } @else {
            {{ user.email }}
          }
        </td>

        <td>
          @if (isEdit) {
            <mat-form-field appearance="outline">
              <mat-select [(ngModel)]="user.role">
                <mat-option value="Admin">Admin</mat-option>
                <mat-option value="General User">General User</mat-option>
              </mat-select>
            </mat-form-field>

          } @else {
            {{ user.role }}
          }
        </td>
      </tr>
    }
  </tbody>
</table>


  <!-- Pagination Bottom -->
  @if (totalPages > 1) {
    <div class="pagination flex items-center gap-3 mt-3">
      <button mat-stroked-button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">Prev</button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button mat-stroked-button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
    </div>
  }
</div>

<!-- Logout Confirmation Dialog Template -->
<ng-template #logoutDialog>
  <h2 mat-dialog-title>Confirm Logout</h2>
  <mat-dialog-content>Are you sure you want to log out?</mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-button color="warn" [mat-dialog-close]="'confirm'">Logout</button>
  </mat-dialog-actions>
</ng-template>
